<!doctype html>
<html>
    <head>
        <meta charset="utf-8">    
        <title>Checkbox</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
        <style>
            .result {
                display: none;
            }

            .result-success {
                color: green;
            }

            .result-error {
                color: red;
            }
        </style>
    </head>
    <body>
    	<label for="isActive">Active: </label>
        <input id="isActive" type="checkbox" name="isActive" data-name="isActive" data-pk="1" data-value="0" data-confirmation="true">
        <div class="result"></div>

       <!--  <div id="MsgBoxBack" class="divMessageBox animated fadeIn fast">
            <div id="Msg1" class="MessageBoxContainer animated fadeIn fast">
                <div class="MessageBoxMiddle">
                    <span class="MsgTitle">
                        <i class="fa fa-sign-out txt-color-orangeDark"></i> 
                        Logout 
                        <span class="txt-color-orangeDark">
                            <strong> john.doe </strong>
                        </span> 
                        ?
                    </span>

                    <p class="pText">You can improve your security further after logging out by closing this opened browser</p>
                    <div class="MessageBoxButtonSection">
                        <button class="btn btn-default btn-sm botTempo" id="bot1-Msg1"> No</button>
                        <button class="btn btn-default btn-sm botTempo" id="bot2-Msg1"> Yes</button>
                    </div>
                </div>
            </div>
        </div> -->
        
        <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
        <script src="/checkbox/libs/bootbox.js"></script>
        <script>
            var selector = '#isActive';
            var $checkBox = $(selector);
            var name = $checkBox.attr('data-name');
            var pk = $checkBox.attr('data-pk');
            var url = '/Checkbox/serverside.cfc?method=test';
            var confirmation = $checkBox.attr('data-confirmation');
            var value = $checkBox.attr('data-value');
            var errorMessage = 'Something went wrong';
            var successMessage = 'Your change was successfully made!';

            $checkBox.click(main);

            function main() {
                $loadingImage = $('<img src="/checkbox/loading.gif" alt="loading"/>');
                $checkBox.replaceWith($loadingImage);

                var data = {
                    'name': name,
                    'pk': pk,
                    'value': value,
                };

                if(confirmation) {
                    makeConfirmation();

                    //Todo: confirm or die
                }

                makeRequest(url, data);
            }

            function makeConfirmation() {
                var $confirmationBG = $('<div class="confirmation-background">');
            }

            function makeRequest(url, data) {
                $.ajax({
                    url: url,
                    type: 'POST',
                    data: data,
                })
                .done(function(data){

                    $loadingImage.replaceWith($checkBox);
                    $checkBox.click(main);
                    addMessage('success', successMessage);
                })
                .fail(function(err) {
                    $loadingImage.replaceWith($checkBox);
                    addMessage('error', errorMessage);
                    $checkBox.click(main);
                    
                });
            }

            function addMessage(type, text, duration = 3000) {
                $('.result').empty();
                $('.result').html('<span class="result-' + type + '">' + text + '</span>');
                $('.result').css('display', 'block');

                setTimeout(function() {
                    $('.result').hide();
                }, duration);
            }
            
        </script>
    </body>
</html>